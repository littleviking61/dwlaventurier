jQuery(function(a){"use strict";function b(){var b=a(".timeline"),c=b.outerWidth(),d=b.find(".dwtl");if(c>=800){b.removeClass("one-col").addClass("two-col");var e=0,f=0;d.each(function(b,c){a(c).hasClass("normal")?f>=e?(a(c).removeClass("dwtl-right").addClass("dwtl-left"),e+=a(c).outerHeight()):(a(c).removeClass("dwtl-left").addClass("dwtl-right"),f+=a(c).outerHeight()):a(c).hasClass("full")&&(e=0,f=0)}),a(".dwtl").css({opacity:1})}else b.removeClass("two-col").addClass("one-col"),d.each(function(b,c){a(c).removeClass("dwtl-left dwtl-right")})}function c(){a(".wp-editor-wrap").hasClass("tmce-active")?tinyMCE.get("dwtl-post-editor").setContent(""):a("#dwtl-post-editor").val(""),jQuery("#dwtl-post-form-content").find('input:not([type="button"],[type="submit"],#dwtl-post-form-nonce,[name="_wp_http_referer"]),textarea:not(#dwtl-post-editor)').val(""),jQuery("#tab-image .image-preview, #tab-standard .thumbnail-preview,#tab-video .video-preview, #tab-link .link-preview").html("")}var d="standard";a("#dwtl-post-form-holder-text, #dwtl-post-form-holder .post-formats button").on("click",function(e){e.preventDefault();var f=a("#dwtl-post-form-holder"),g=a(this),h=f.closest(".dwtl");if(h.removeClass("normal dwtl-left").addClass("active"),a(".wrap").addClass("post-form-active"),a(".dwtl-post-editor-box").removeClass("hide"),g.is("button")){var i=g.attr("id").replace("option-","");i!=d&&(c(),d=i)}else d="standard";a(".dwtl-post-editor-box .tab-content").addClass("hide"),a(".dwtl-post-editor-box #tab-"+d).removeClass("hide"),"standard"==d&&a(".wp-editor-wrap").hasClass("tmce-active")&&(tinymce.EditorManager.execCommand("mceRemoveControl",!0,"dwtl-post-editor"),tinymce.EditorManager.execCommand("mceAddControl",!0,"dwtl-post-editor")),f.hide(),b()}),a(".dwtl-post-form-cancel").on("click",function(d){d.preventDefault();var e=a(".dwtl-post-form");return a(".dwtl-post-form .loading").removeClass("loading"),a(".dwtl-post-form-submit").removeAttr("disabled","disabled"),a("#tab-link .alert").remove(),e.length>0&&(e.find(".dwtl-post-editor-box").addClass("hide"),e.find("#dwtl-post-form-holder").show(),e.removeClass("active").addClass("normal dwtl-left"),a(".wrap").removeClass("post-form-active"),b(),c()),!1}),jQuery(document).ready(function(a){var e,f,g;e=wp.media.frames.file_frame=wp.media({title:"Choose Image",button:{text:"Choose Image"},multiple:!1}),e.on("select",function(){g=e.state().get("selection").first().toJSON();var b='<img src="'+g.sizes.full.url+'" alt="'+g.alt+'" class="img-thumbnail" >';f.is("#dwtl-add-media")?(a("#tab-image .image-preview").html(b),a("#dwtl-image-caption").val().length<=0&&a("#dwtl-image-caption").val(g.caption)):f.is("#dwtl-add-thumbnail")&&a("#tab-standard .thumbnail-preview").html(b),a("#dwtl-post-thumbnail").val(g.id)}),a("#dwtl-add-media, #dwtl-add-thumbnail").on("click",function(b){return b.preventDefault(),f=a(this),e?void e.open():void e.open()}),a("#dwtl-video-url, #dwtl-link").on("keypress",function(a){var b=a.which||a.keyCode;return 13==b?(a.preventDefault(),!1):void 0});a("#dwtl-link").on("change",function(){var b=function(a){for(var b,c=(a||"").toString(),d=[],e=/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)|((mailto:)?[_.\w-]+@([\w][\w\-]+\.)+[a-zA-Z]{2,3})/g;null!==(b=e.exec(c));){var f=b[0];d.push(f)}return d[0]},c=a(this),d=b(c.val()),e=c.data("nonce");a("#dwtl-post-title").html(""),a("#dwtl-post-title").val(""),d&&(a(this).parent().addClass("loading"),a(".dwtl-post-form-submit").attr("disabled","disabled"),a.ajax({url:dwtl.ajax_url,type:"POST",dataType:"json",data:{action:"dwtl-parse-url",url:d,nonce:e}}).done(function(b){if(b.success)a("#dwtl-post-title").val(b.data.title),a("#tab-link .link-preview").html(b.data.preview).data({title:b.data.title,description:b.data.description,url:b.data.url}),a("#tab-link .loading").removeClass("loading"),a(".dwtl-post-form-submit").removeAttr("disabled","disabled"),a("#tab-link .alert").remove();else{var c='<div class="col-sm-12 col-md-12"><strong><a href="'+d+'">'+d+"</a></strong><p>"+b.data.message+"</p></div>";a("#tab-link .link-preview").html(c).data({title:"",description:b.data.message,url:d}),a("#tab-link .loading").removeClass("loading"),a(".dwtl-post-form-submit").removeAttr("disabled","disabled"),a("#tab-link").append('<div class="alert alert-warning fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><strong>Error!</strong> Please try other link</div>')}}).fail(function(){a("#tab-link .loading").removeClass("loading"),a(".dwtl-post-form-submit").removeAttr("disabled","disabled"),a("#tab-link").append('<div class="alert alert-warning fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><strong>Error!</strong> Please try other link</div>')}))}),a("#dwtl-video-url").on("change",function(){var b=function(a){for(var b,c=(a||"").toString(),d=[],e=/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)|((mailto:)?[_.\w-]+@([\w][\w\-]+\.)+[a-zA-Z]{2,3})/g;null!==(b=e.exec(c));){var f=b[0];d.push(f)}return d[0]},c=a(this),d=b(c.val()),e=c.data("nonce");d&&(a(this).parent().addClass("loading"),a(".dwtl-post-form-submit").attr("disabled","disabled"),a.ajax({url:dwtl.ajax_url,type:"POST",dataType:"json",data:{action:"dwtl-parse-video-link",url:d,nonce:e}}).done(function(b){b.success&&a("#tab-video .video-preview").html(b.data.html),a("#tab-video .loading").removeClass("loading"),a(".dwtl-post-form-submit").removeAttr("disabled","disabled")}).fail(function(){a("#tab-video .loading").removeClass("loading"),a(".dwtl-post-form-submit").removeAttr("disabled","disabled")}))});var h=!1;a("#dwtl-post-form-content").on("submit",function(e){e.preventDefault(),a("#tab-link .alert").remove();a("#tab-link #dwtl-link").val();if(h)return!1;var f=a(this),g="";if(f.addClass("loading"),"image"==d)g=f.find(".img-thumbnail").attr("src");else if("link"==d){g=f.find("#dwtl-link-caption").val();var i=f.find("#tab-link .link-preview");if(i.length){var j=i.find(".carousel .item.active img").attr("src"),k="col-sm-7 col-md-8";j||(k="col-sm-12 col-md-12"),g+="<br>",g+='<div class="link-preview row">',j&&(g+='<div class="col-sm-5 col-md-4"><img style="width:100%" src="'+i.find(".carousel .item.active img").attr("src")+'"></div>'),g+='<div class="'+k+'"><strong><a href="'+i.data("url")+'">'+i.data("title")+"</a></strong>"+i.data("description")+"</div>",g+="</div>"}else g+='<div class="col-sm-12 col-md-12"><strong><a href="'+a("#tab-link #dwtl-link").val()+'">'+a("#tab-link #dwtl-link").val()+"</a></strong></div>"}else"video"==d?(g=f.find("#dwtl-video-caption").val(),a("#tab-video #dwtl-video-url").val()&&(g=a("#tab-video #dwtl-video-url").val()+"\n"+g)):(g=a("#dwtl-post-editor").val(),a(".wp-editor-wrap").hasClass("tmce-active")&&(g=tinyMCE.get("dwtl-post-editor").getContent()));return g.length<=0?!1:(h=!0,a.ajax({url:dwtl.ajax_url,type:"POST",dataType:"json",data:{action:"dwtl-front-submit-post",content:g,post_format:d,thumbnail:f.find("#dwtl-post-thumbnail").val(),title:f.find("#dwtl-post-title").val(),tags:f.find("#dwtl-post-tags").val(),categories:f.find('[name="dwtl-post-categories"]').val(),referer:f.find('[name="_wp_http_referer"]').val(),nonce:f.find('[name="dwtl-post-form-nonce"]').val()}}).done(function(d){c(),a(".dwtl-post-editor-box").addClass("hide"),f.closest(".dwtl-post-form").removeClass("full").addClass("normal dwtl-left").find("#dwtl-post-form-holder").show(),d.success&&(f.closest(".dwtl-post-form").after(d.data.html),b())}).always(function(){h=!1,f.removeClass("loading")}),!1)})})});